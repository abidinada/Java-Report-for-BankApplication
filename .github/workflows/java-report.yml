name: Java Report

on:
  push:
    branches: ["main"]
  pull_request:
    branches: ["main"]
  workflow_dispatch:

jobs:
  analyze:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Count Java files and lines
        id: count
        run: |
          JAVA_FILES=$(find . -name "*.java")
          
          # Fail if no Java files
          if [ -z "$JAVA_FILES" ]; then
            echo " Error: No Java files found."
            exit 1
          fi

          # Fail if .class files exist
          CLASS_FILES=$(find . -name "*.class")
          if [ ! -z "$CLASS_FILES" ]; then
            echo " Error: Compiled .class files found in repo. Remove them."
            exit 1
          fi

          echo " Java File Report" > java-file-report.txt
          echo "" >> java-file-report.txt

          # Number of Java files
          FILE_COUNT=$(echo "$JAVA_FILES" | wc -l)
          echo "Number of .java files: $FILE_COUNT" >> java-file-report.txt
          echo "" >> java-file-report.txt

          # Total lines
          TOTAL_LINES=0

          echo "Per-file breakdown:" >> java-file-report.txt
          echo "-------------------" >> java-file-report.txt

          for file in $JAVA_FILES; do
            LINES=$(wc -l < "$file")
            TOTAL_LINES=$((TOTAL_LINES + LINES))
            echo "$file â€“ $LINES" >> java-file-report.txt
          done

          echo "" >> java-file-report.txt
          echo "Total lines of Java code: $TOTAL_LINES" >> java-file-report.txt

      - name: Upload report artifact
        uses: actions/upload-artifact@v4
        with:
          name: java-file-report
          path: java-file-report.txt
